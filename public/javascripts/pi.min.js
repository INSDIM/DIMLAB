$(function(){var config={bgcolor:"#2f52a3",color1:"#27568f",color2:"#000",color3:"#000",fade:.99,fill:!0,groupSize:1,lineWidth:1,num:67,opacity:.02,rotation:1,shape:"triangle",size:2.7,spacing:.3,speed:.14,stroke:!1,wavelength:1.76,zoom:1},targetConfig=_.clone(config);targetConfig.rotation=-.5,targetConfig.size=1.5,targetConfig.num=55,window.targetConfig=targetConfig;var canvas=document.getElementById("spiral-buffer-ilona");canvas.width=window.innerWidth,canvas.height=window.innerHeight,window.onresize=function(){canvas.width=window.innerWidth,canvas.height=window.innerHeight,bufferCanvas.width=canvas.width,bufferCanvas.height=canvas.height};var mainCtx=canvas.getContext("2d"),bufferCanvas=document.createElement("canvas"),bufferCtx=bufferCanvas.getContext("2d");bufferCanvas.width=canvas.width,bufferCanvas.height=canvas.height;var W=canvas.width,H=canvas.height,CX=W/2,CY=H/2,PI2=2*Math.PI,shapes={circle:drawCircle,triangle:drawTriangle,square:drawSquare};function draw(ctx,t,n){var color_index=1+Math.floor(n/config.groupSize)%3,color=config["color"+color_index],rotation=t/2e3;ctx.save(),ctx.translate(CX,CY),ctx.rotate(rotation),ctx.strokeStyle=color,ctx.fillStyle=color,ctx.lineWidth=config.lineWidth;var ss=config.wavelength,size=config.size*(Math.sin(t/911*ss)*CX*.3+Math.cos(t/800*ss)*CX*.2+Math.sin(t/320*ss)*CX*.1),x=Math.sin(t/787*ss)*CX*.37,y=Math.sin(t/997*ss)*CY*.13;shapes[config.shape](ctx,x,y,size),config.fill&&ctx.fill(),config.stroke&&ctx.stroke(),ctx.restore()}function drawCircle(ctx,x,y,r){r=Math.abs(r),ctx.save(),ctx.beginPath(),ctx.arc(x,y,r,0,PI2),ctx.restore()}function drawTriangle(ctx,x,y,size){ctx.save(),ctx.translate(x,y),ctx.beginPath(),ctx.moveTo(0,size),ctx.lineTo(size/2,0),ctx.lineTo(-size/2,0),ctx.lineTo(0,size),ctx.restore()}function drawSquare(ctx,x,y,size){ctx.save(),ctx.translate(x,y),ctx.beginPath(),ctx.moveTo(0,size),ctx.lineTo(size,size),ctx.lineTo(size,0),ctx.lineTo(0,0),ctx.lineTo(0,size),ctx.restore()}function render(t){bufferCtx.clearRect(0,0,bufferCanvas.width,bufferCanvas.height),bufferCtx.globalAlpha=config.fade,bufferCtx.drawImage(canvas,0,0),bufferCtx.globalAlpha=config.opacity;for(var n=0;n<config.num;n++)draw(bufferCtx,(t+n*config.spacing*1e3)*config.speed,n);mainCtx.save(),mainCtx.fillStyle=config.bgcolor,mainCtx.fillRect(0,0,canvas.width,canvas.height),mainCtx.translate(CX,CY),mainCtx.scale(1+config.zoom/100,1+config.zoom/100),mainCtx.rotate(config.rotation/100),mainCtx.translate(-CX,-CY),mainCtx.drawImage(bufferCanvas,0,0),mainCtx.restore(),requestAnimationFrame(render),easeObject(config,targetConfig)}function updateBackground(val){$("canvas").css("backgroundColor",val||config.bgcolor)}function ease(val,to,gain){return val+(to-val)*gain}function easeObject(obj,targetObj,gain){gain=gain||.045,_.each(obj,function(val,prop){_.isNumber(val)?obj[prop]=ease(val,targetObj[prop],gain):obj[prop]=targetObj[prop]})}updateBackground(),render(0)});